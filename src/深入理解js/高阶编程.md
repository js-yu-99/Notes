# 高阶编程技巧

## 单例设计模式

### 模块化编程

按模块划分，模块之间是相互独立的，但能相互调用

+ 单例设计模式：描述同一内容的属性和方法归到一个命名空间中，避免全局污染

+ AMD require.js
+ commonJS

+ CMD sea.js

+ ED6Module



#### 单例模式

```js
// 一个对象就是一个单例
let person = {
	name: 'wang',
  age: 10
}

// 闭包 + 单例 -> 高级单例模式
let infoObj = (function () {
  const name = 'wangyu'
  return {
    name
  }
})
```



## 惰性函数

只在需要的时候执行一次

```js
let getCss = function (ele, attr) {
	if (typepf getComputedStyle !== 'undefined') {
    getCss = function (ele, attr) {
      return window.getComputedStyle(ele)[attr];
    }
  } else {
    getCss = function (ele, attr) {
      return ele.currentStyle[attr];
    }
  }
  return getCss(ele, attr);
}
// getCss 内部的判断只执行一次
console.log(getCss(document.body, 'width'))
console.log(getCss(document.body, 'backgroungColor'))
```



## 函数柯里化

闭包的进阶应用

**核心：预先处理、预先存储，利用闭包的保存作用（凡是形成一个闭包，存储一些信息，供其上级上下文调取使用的），都是柯里化思想**



```js
const curring = function () {
    let arr = [];
    const add = (...params) => {
        arr = arr.concat(params);
        return add;
    };
    add.toString = () => {
        return arr.reduce((total, item) => {
            return total + item;
        })
    }
    return add;
}

let add = curring();
let res = add(1)(2)(3);
console.log(String(res)) // 6

add = curring();
res = add(1, 2, 3)(4);
console.log(String(res)) // 10
add = curring();
res = add(1)(2)(3)(4)(5);
console.log(String(res)) // 15
```

## 组合函数（compose函数）

```js
// f(g(h(x))) => compose(f, g, h)(x)
function compose(...funcs) { // funcs => [fn1, fn2, fn3]
  return function operate(x) {
    if (funcs.length === 0) {
      return x;
    }
    if (funcs.length === 1) {
      return funcs[0](x);
    }
    return funcs.reduceRight((result, item) => { // result => x item => fn3
      return item(result);
    }, x);
  }
}

function compose(...funcs) {
  if (funcs.length) {
    return arg => arg;
  }
  if (funcs.length === 1) {
    return funcs[0];
  }
  return funcs.reduce((a, b) => (...args) => a(b(...args)));
}

const fn1 = x => x + 1;
const fn2 = x => x * 3;
const fn3 = x => x / 2;
const operate = compose(fn1, fn2, fn3);
console.log(operate(1));
console.log(operate(10));
```

