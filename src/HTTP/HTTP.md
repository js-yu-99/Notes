HTTP(HyperText Transfer Protocol，超文本传输协议)

1989 年，任职于欧洲核子研究中心（CERN）的蒂姆·伯纳斯 - 李（Tim Berners-Lee）发表了一篇论文，提出了在互联网上构建超链接文档系统的构想。这篇论文中他确立了三项关键技术。

- URI：即统一资源标识符，作为互联网上资源的唯一身份；
- HTML：即超文本标记语言，描述超文本文档；

- HTTP：即超文本传输协议，用来传输超文本。



## HTTP版本：

- HTTP/0.9：是个简单的文本协议，只能获取文本资源；
- HTTP/1.0：确立了大部分现在使用的技术，但它不是正式标准；

- - 增加了 HEAD、POST 等新方法；
  - 增加了响应状态码，标记可能的错误原因；

- - 引入了协议版本号概念；
  - 引入了 HTTP Header（头部）的概念，让 HTTP 处理请求和响应更加灵活；

- - 传输的数据不再仅限于文本；

- HTTP/1.1：是目前互联网上使用最广泛的协议，功能也非常完善；

- - 增加了 PUT、DELETE 等新的方法；
  - 增加了缓存管理和控制；

- - 明确了连接管理，允许持久连接；
  - 允许响应数据分块（chunked），利于传输大文件；强制要求 Host 头，让互联网主机托管成为可能；

- HTTP/2.0：基于 Google 的 SPDY 协议，注重性能改善，但还未普及；

- - 二进制协议，不再是纯文本；
  - 可发起多个请求，废弃了 1.1 里的管道

- - ；使用专用算法压缩头部，减少数据传输量；
  - 允许服务器主动向客户端推送数据；

- - 增强了安全性，“事实上”要求加密通信；

- HTTP/3：基于 Google 的 QUIC 协议，是将来的发展方向。



## HTTP是什么？

- 协议：有两个或者多个参与者、对参与者的一种行为约定和规范

- - ***HTTP 是一个用在计算机世界里的协议。它使用计算机能够理解的语言确立了一种计算机之间交流通信的规范，以及相关的各种控制和错误处理方式。***

- 传输：A <===> B  双向协议，A、B之间可以存在中转和接力

- - ***HTTP 是一个在计算机世界里专门用来在两点之间传输数据的约定和规范。\***

- 超文本：“超越了普通文本的文本”，它是文字、图片、音频和视频等的混合体，最关键的是含有“超链接”，能够从一个“超文本”跳跃到另一个“超文本”，形成复杂的非线性、网状的结构关系。

- - ***HTTP 是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范***

## HTTP不是什么？

- HTTP 不是互联网
- HTTP 不是编程语言

- HTTP 不是 HTML
- HTTP 不是一个孤立的协议

- - 在互联网世界里，HTTP 通常跑在 TCP/IP 协议栈之上，依靠 IP 协议实现寻址和路由、TCP 协议实现可靠数据传输、DNS 协议实现域名查找、SSL/TLS 协议实现安全通信。此外，还有一些协议依赖于 HTTP，例如 WebSocket、HTTPDNS 等。这些协议相互交织，构成了一个协议网，而 HTTP 则处于中心地位。

![img](https://cdn.nlark.com/yuque/0/2021/png/21510703/1634030747817-10cff3b4-5dc4-4d4d-b830-b29c53cbfabe.png)

- 你觉得 CDN 在对待浏览器和爬虫时会有差异吗？为什么？

- - **不会，当爬虫的浏览器都使用一样的useragent时，cdn并不能识别**

- 你怎么理解 WebService 与 Web Server 这两个非常相似的词？

- - **web server就是提供http服务的server、web service就是运行在http协议上的服务接口规范。**



IP 协议是“Internet Protocol”的缩写，主要目的是解决寻址和路由问题，以及如何在两点间传送数据包。IP 协议使用“IP 地址”的概念来定位互联网上的每一台计算机。

TCP 协议是“Transmission Control Protocol”的缩写，意思是“传输控制协议”，它位于 IP 协议之上，基于 IP 协议提供可靠的、字节流形式的通信，是 HTTP 协议得以实现的基础。“可靠”是指保证数据不丢失，“字节流”是指保证数据完整，所以在 TCP 协议的两端可以如同操作文件一样访问传输的数据，就像是读写在一个密闭的管道里“流动”的字节。



## TCP/IP网络分层模型

![img](https://cdn.nlark.com/yuque/0/2021/png/21510703/1634120348637-dc9777d5-7fc7-4b31-83ac-0eabca0c868d.png)

TCP/IP 协议总共有四层，就像搭积木一样，每一层需要下层的支撑，同时又支撑着上层，任何一层被抽掉都可能会导致整个协议栈坍塌。

- **数据链路层（数据链路层，网络接口层）**

- - 负责在以太网、WiFi 这样的底层网络上发送原始数据包，工作在网卡这个层次，使用 MAC 地址来标记网络上的设备，所以有时候也叫 MAC 层。MAC 层的传输单位是帧（frame），IP 层的传输单位是包（packet），TCP 层的传输单位是段（segment），HTTP 的传输单位则是消息或报文（message）。但这些名词并没有什么本质的区分，可以统称为数据包。

- **网络层（网络互连层）**

- - IP 协议就处在这一层。因为 IP 协议定义了“IP 地址”的概念，所以就可以在“链接层”的基础上，用 IP 地址取代 MAC 地址，把许许多多的局域网、广域网连接成一个虚拟的巨大网络，在这个网络里找设备时只要把 IP 地址再“翻译”成 MAC 地址就可以了。

- **传输层**

- - TCP（传输控制协议）、UDP（用户数据报协议）
  - 这个层次协议的职责是保证数据在 IP 地址标记的两点之间“可靠”地传输，是 TCP 协议工作的层次，另外还有它的一个“小伙伴”UDP。TCP 是一个有状态的协议，需要先与对方建立连接然后才能发送数据，而且保证数据不丢失不重复。而 UDP 则比较简单，它无状态，不用事先建立连接就可以任意发送数据，但不保证数据一定会发到对方。两个协议的另一个重要区别在于数据的形式。TCP 的数据是连续的“字节流”，有先后顺序，而 UDP 则是分散的小数据包，是顺序发，乱序收。

- **应用层**

- - 应用层决定了向用户提供应用服务时通信的活动。
  - TCP/IP提供了各类服务协议：FTP、DNS、HTTP等协议



### TCP/IP 协议栈的工作方式

![img](https://cdn.nlark.com/yuque/0/2021/png/21510703/1631015578265-5191f5aa-d339-458f-8a4f-98cfd55952b0.png)

![img](https://cdn.nlark.com/yuque/0/2021/png/21510703/1634135604741-69627296-9a46-4c94-9c69-230eb7749ae6.png)

![img](https://cdn.nlark.com/yuque/0/2021/png/21510703/1631016144379-3e5db1eb-f7db-494b-a0d8-83ef77353461.png)

发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该层所属的首部信息。返回，接收端在层与层传输数据时，每经过一层时会把对应的首部消去。这种把数据信息包装起来的做法称为**封装（encapsulate）**



## OSI 网络分层模型

OSI，全称是“开放式系统互联通信参考模型”（Open System Interconnection Reference Model）。

OSI 模型分成了七层，部分层次与 TCP/IP 很像，从下到上分别是：

![img](https://cdn.nlark.com/yuque/0/2021/png/21510703/1634135155466-5ba58b16-acbd-472b-9658-8e11eef1dd0b.png)

1. 第一层：物理层，网络的物理形式，例如电缆、光纤、网卡、集线器等等；
2. 第二层：数据链路层，它基本相当于 TCP/IP 的链接层；
3. 第三层：网络层，相当于 TCP/IP 里的网络层；
4. 第四层：传输层，相当于 TCP/IP 里的传输层；
5. 第五层：会话层，维护网络中的连接状态，即保持会话和同步；
6. 第六层：表示层，把数据转换为合适、可理解的语法和语义；
7. 第七层：应用层，面向具体的应用传输数据。

### TCP/IP与OSI模型的对应关系

![img](https://cdn.nlark.com/yuque/0/2021/png/21510703/1634135250001-98202a62-af71-4326-a901-45ca0f2b58d0.png)

1. 第一层：物理层，TCP/IP 里无对应；
2. 第二层：数据链路层，对应 TCP/IP 的链接层；
3. 第三层：网络层，对应 TCP/IP 的网际层；
4. 第四层：传输层，对应 TCP/IP 的传输层；
5. 第五、六、七层：统一对应到 TCP/IP 的应用层。

所谓的“**四层负载均衡**”就是指工作在传输层上，基于 TCP/IP 协议的特性，例如 IP 地址、端口号等实现对后端服务器的负载均衡。

所谓的“**七层负载均衡**”就是指工作在应用层上，看到的是 HTTP 协议，解析 HTTP 报文里的 URI、主机名、资源类型等数据，再用适当的策略转发给后端服务器。

“两个凡是”：凡是由操作系统负责处理的就是四层或四层以下，否则，凡是需要由应用程序（也就是你自己写代码）负责处理的就是七层。



**你能用自己的话解释一下“二层转发”“三层路由”吗？**

- 二层转发：二层应该指数据链路层，工作在二层的设备，通过查找到目标MAC地址，进行数据转发
- 三层路由：三层应该指网络层，工作在三层的设备，通过解析数据包头信息，找到目标IP地址，转发数据

**你认为上一讲中的 DNS 协议位于哪一层呢？**

+ 应用层

**你认为 CDN 工作在那一层呢？**

+ 应用层



## 与HTTP相关的协议：IP、TCP、DNS

#### 负责传输的IP协议

- IP(Internet Protocol)网络协议位于网络层。
- IP地址的作用是把各种数据包传送给对方（主要两个传送条件是IP地址和MAC地址）。

- IP地址指明了节点被分配到的地址，MAC地址是指网卡所属的固定地址。IP地址可以和MAC地址进行配对。IP地址可变换，但MAC地址基本上不会更改。
- IP间的通信依赖MAC地址。在进行中转发送时，会利用下一站中转设备的MAC地址来搜索下一个中转目标。这时，会通过ARP协议（Address Resolution Protocol  -- 地址解析协议）。根据通信方的IP地址反查对应的MAC地址。

#### 确保可靠性的TCP协议

- TCP位于传输层，提供可靠的字节流服务
- 字节流服务是指为了方便传输将大块数据分割成以报文段为单位的数据包进行管理。

- 三次握手

- - 第一次握手：发送端首先发送一个带SYN标志的数据包给对方。（此次握手可以理解为发送端在进行发送端发送能力和接收端接收能力的测试。）
  - 第二次握手：接收端收到后，回传一个带有SYN/ACK标志的数据包以示传达确认的信息。（此次握手接收端确认了发送端的发送能力以及接收端的接收能力。并且再次进行接收端发送能力和发送端接收能力的测试。）

- - 第三次握手：发送端再回传一个带ACK标志的数据包，代表“握手”结束。（此次握手发送端确认接收端的发送能力和发送端的接受能力。并继续进行接收端发送能力的测试。当接收端收到发送端再次发送的内容，证明发送端和接收端接收发送能力都正常，可以建立链接进行数据传输。）

#### 负责域名解析的DNS服务

- DNS服务时和HTTP协议一样位于应用层的协议。它提供域名到IP地址之间的解析服务。



## 域名

### 域名的形式

域名是一个有层次的结构，是一串用“.”分割的多个单词，最右边的被称为“顶级域名”，然后是“二级域名”，层级关系向左依次降低。最左边是主机名，通常用来表明主机的用户。

`www.baidu.com `域名中， `com`是顶级域名，`baidu`是二级域名，`www`是主机名。

域名本质上是类似namespace的命名空间系统，使用多级域名就可以划分出不同的国家、地区、组织、公司等，每个域名都是独一无二的。

### 域名的解析

DNS的核心系统是一个三层的树状、分布式服务，基于对应域名的结构

- `根域名服务器`：管理顶级域名服务器，返回“com”“net”“cn”等顶级域名服务器的 IP 地址；
- `顶级域名服务器`：管理各自域名下的权威域名服务器，比如 com 顶级域名服务器可以返回 .com 域名服务器的 IP 地址；

- `权威域名服务器`：管理自己域名下主机的 IP 地址，比如 baidu.com 权威域名服务器可以返回 www.baidu.com 的 IP 地址。

在这里根域名服务器是关键，它必须是众所周知的，否则下面的各级服务器就无从谈起了。目前全世界共有 13 组根域名服务器，又有数百台的镜像，保证一定能够被访问到。

有了这个系统以后，任何一个域名都可以在这个树形结构里从顶至下进行查询，就好像是把域名从右到左顺序走了一遍，最终就获得了域名对应的 IP 地址。

例如，访问“www..com”，就要进行下面的三次查询：访问根域名服务器，它会告诉你“com”顶级域名服务器的地址；访问“com”顶级域名服务器，它再告诉你“baidu.com”域名服务器的地址；最后访问“baidu.com”域名服务器，就得到了“www.baidu.com”的地址。

### DNS缓存

为了减少域名解析的压力，提供了多种基于缓存的手段。

1. 许多大公司、网络运行商都会建立自己的 DNS 服务器，作为用户 DNS 查询的代理，代替用户访问核心 DNS 系统。这些“野生”服务器被称为“非权威域名服务器”，可以缓存之前的查询结果，如果已经有了记录，就无需再向根服务器发起查询，直接返回对应的 IP 地址。
2. 操作系统里也会对 DNS 解析结果做缓存，如果你之前访问过“www.baidu.com”，那么下一次在浏览器里再输入这个网址的时候就不会再跑到 DNS 那里去问了，直接在操作系统里就可以拿到 IP 地址。另外，操作系统里还有一个特殊的“主机映射”文件，通常是一个可编辑的文本，在 Linux 里是“/etc/hosts”，在 Windows 里是“C:\WINDOWS\system32\drivers\etc\hosts”，如果操作系统在缓存里找不到 DNS 记录，就会找这个文件。



## URI和URL

### 统一资源标识符URI

Uniform Resource Identifier

URI是由某个协议方案表示的资源的定位标识符。协议方案是指访问资源所使用的协议类型名称。

URI用字符串标识某一互联网资源，而URL表示资源的地点。URL是URI的子集。

### URI格式

- 登录信息（认证）
- 服务器地址

- 服务器端口号
- 带层次的文件路径

- 查询字符串
- 片段标识符



# 简单的HTTP协议

+ P协议用户客户端和服务器端之间通信

+ 通过请求和响应的交换达成通信

+ HTTP是无状态的协议

+ 使用URI定位互联网上的资源

+ 告知服务器意图的HTTP方法

1. + GET：获取资源

2. + POST：传输实体主体

1. + PUT：传输文件（但是因为http1.1的put方法不带验证机制，所以存在安全性问题）

2. + HEAD：获取报文首部（用于确定URI的有效性及资源更新的日期时间等）

1. + DELETE：删除文件（同样http1.1中delete方法不带验证机制，存在安全性问题）

2. + OPTIONS：查询针对请求URI指定的资源支持的方法

1. + TRACE：追踪路径（让web服务器将之前的请求通信环回给客户端）

1. 1. 1. 不常用，并且容易引起XST（跨站追踪）攻击，通常就更不会用到了

1. + CONNECT：要求用隧道协议连接代理

1. 1. 1. 主要使用SSL（安全套接层）和TLS（传输层安全）协议把通信内容加密后经网络隧道传输

+ 持久连接节省通信量

+ + keep-alive

+ 管线化

1. + 不必顶导发送请求后需等待并收到响应，才能发送下一个请求

+ 使用Cookie的状态管理

1. + Cookie技术通过在请求和响应报文中写入Cookie信息来控制客户端的状态。

2. + 服务端发送一个Set-Cookie的首部字段信息，通知客户端保存Cookie。

# HTTP报文中的HTTP信息

用于HTTP协议交互的信息被称为HTTP报文。客户端的HTTP报文叫做请求报文，服务端的叫做响应报文。HTTP报文本身是由多行（用CR + LF作换行符）数据构成的字符串文本。

