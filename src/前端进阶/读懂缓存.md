# 缓存概念与分类

## 缓存有哪些？

数据库缓存、服务器缓存、CDN缓存、HTTP缓存、DNS缓存等。

> HTTP权威指南中指出：在前端开发中，性能一直是被大家所重视的一点，然而判断一个网站心梗如何的最直观的方法就是看网页打开的速度。其中，提高网页打开速度的一个方式就是使用缓存。一个优秀的缓存策略可以缩短网页请求资源的距离，减少延迟。并且由于缓存文件可以重复利用，因此可以减少带宽，降低网络负荷。

## 缓存带来的好处

+ 使网页加载和呈现速度更快。
+ 由于减少了不必要的数据传输，因而可以节省网络流量和带宽
+ 在上一步的基础上，可以减少服务器的负担。

## 浏览器缓存的分类

### 按缓存位置划分

内容缓存（memory cache）、硬盘缓存（disk cache）、service worker等。

浏览器的资源缓存可以分为硬盘缓存和内存缓存两类。当首次访问网页时，资源文件被缓存在内存中，同时也会在本地磁盘中保留一份副本。当用户刷新页面时，如果缓存的资源没有过期，就可以直接从内存中读取数据并加载。当用户关闭页面后，当前页面缓存在内存中的资源就会被清空。当用户再一次访问页面时，如果资源文件的缓存没有过期，就可以从本地磁盘家在数据并再次缓存到内存中。

### 按缓存策略划分

+ 强缓存
  + Expires
  + Cache-Control
    + no-cache：不缓存过期资源
    + max-age
    + no-store：不进行缓存
    + public
    + private
+ 协商缓存
  + Etag
    + Etag
    + If-None-Match
  + Last-modified
    + Last-Modified
    + If-Modified-Since



强制缓存的优先级最高，并且在缓存有效期内浏览器不会因为资源的改动而发送请求，因此强制缓存的使用适用于定且不易修改的资源文件。比如第三方的css、js文件或者图片资源。如果想要提高缓存的灵活性，也可以为文件名加上hash标识进行版本的区分。

协商缓存灵活性高，适用于数据的缓存，采用Etag标识对比文件内容是否发生变化的灵活度最高，也最为可靠。对于数据的缓存，我们可以重点考虑将数据缓存在内存中，因为内存的加载速度最快，并且数据体积小。

> 当用户在浏览器中使用Cirl+F5强制刷新网页时，浏览器会直接从服务器加载网页信息，跳过强缓存和协商缓存。
>
> 当用户只是F5刷新页面时，浏览器会跳过强缓存，但任然进行协商缓存。

| 浏览器相关操作     | 强缓存 | 协商缓存 |
| ------------------ | ------ | -------- |
| 在地址栏中按回车键 | 有效   | 有效     |
| 页面跳转           | 有效   | 有效     |
| 新开窗口           | 有效   | 有效     |
| 浏览器前进、后退   | 有效   | 有效     |
| 浏览器刷新         | 无效   | 有效     |
| 强制刷新           | 无效   | 无效     |



**1.如何禁止浏览器缓存静态资源？**

给请求添加对应请求头

> Cache-Control: no-cache. no-store, must-ervalidate 

或者给资源链接配置hash值

还可以直接通过meta标签的content属性配置no-cache. no-store, must-ervalidate 信息

**2.设置以下请求/响应头会有什么效果？**

> Cache-control: max-age=0

属于强缓存，因为max-age设置为0，所以浏览器必须发送请求重新验证资源。这时，浏览器会根据协商缓存机制进行缓存，并可能返回200或304。

**3.设置以下request/response header会有什么效果？**

> Cache-control: no-cache

属于强缓存，设置no-cache时浏览器必须发送请求重新验证资源、这时，浏览器会根据协商缓存机制进行缓存。

**4.为什么不建议用Etag**

负载均衡调度HTTP请求时，同一个客户端对同一个页面的多次请求很可能被分配到不同的服务器来响应，而根据Etag的计算原理，不同的服务器有可能在资源内容没有变化的情况下，计算出不一样的Etag，而使缓存失效。

